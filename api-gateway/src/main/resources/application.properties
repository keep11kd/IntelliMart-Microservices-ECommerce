# Server Port for API Gateway
server.port=8081

# Spring Application Name (for Eureka registration)
spring.application.name=api-gateway

# Spring Cloud Gateway Configuration
# Using the new recommended properties for Spring Cloud Gateway 3.x+
spring.cloud.gateway.server.webflux.discovery.locator.enabled=true
spring.cloud.gateway.server.webflux.discovery.locator.lower-case-service-id=true

# Spring Cloud Gateway Routes
# Route for Auth Service
spring.cloud.gateway.server.webflux.routes[0].id=auth-service
spring.cloud.gateway.server.webflux.routes[0].uri=lb://AUTH-SERVICE
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/auth/**
spring.cloud.gateway.server.webflux.routes[0].filters[0]=RewritePath=/api/auth/(?<segment>.*), /${segment}

# Route for Eureka Server itself (useful for accessing Eureka dashboard via Gateway)
spring.cloud.gateway.server.webflux.routes[1].id=eureka-server-route
spring.cloud.gateway.server.webflux.routes[1].uri=lb://EUREKA-SERVER
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/eureka/**
spring.cloud.gateway.server.webflux.routes[1].filters[0]=RewritePath=/eureka/(?<segment>.*), /${segment}

# Route for Product Service
spring.cloud.gateway.server.webflux.routes[2].id=product-service
spring.cloud.gateway.server.webflux.routes[2].uri=lb://PRODUCT-SERVICE
spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/api/products/**
spring.cloud.gateway.server.webflux.routes[2].filters[0]=RewritePath=/api/products/(?<segment>.*), /${segment}

# Route for Shopping Cart Service
spring.cloud.gateway.server.webflux.routes[3].id=shopping-cart-service
spring.cloud.gateway.server.webflux.routes[3].uri=lb://SHOPPING-CART-SERVICE
spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/api/cart/**
spring.cloud.gateway.server.webflux.routes[3].filters[0]=RewritePath=/api/cart/(?<segment>.*), /${segment}

# Route for Order Service
spring.cloud.gateway.server.webflux.routes[4].id=order-service
spring.cloud.gateway.server.webflux.routes[4].uri=lb://ORDER-SERVICE
spring.cloud.gateway.server.webflux.routes[4].predicates[0]=Path=/api/orders/**
spring.cloud.gateway.server.webflux.routes[4].filters[0]=RewritePath=/api/orders/(?<segment>.*), /${segment}

# Route for Notification Service
spring.cloud.gateway.server.webflux.routes[5].id=notification-service
spring.cloud.gateway.server.webflux.routes[5].uri=lb://NOTIFICATION-SERVICE
spring.cloud.gateway.server.webflux.routes[5].predicates[0]=Path=/api/notifications/**
spring.cloud.gateway.server.webflux.routes[5].filters[0]=RewritePath=/api/notifications/(?<segment>.*), /${segment}


# Eureka Client Configuration (for registering with Eureka Server)
eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka/

# Configure global filters
# The name here should match the @Component name of your filter, which is "jwtAuthenticationFilter" by default.
spring.cloud.gateway.default-filters[0].name=JwtAuthenticationFilter

# JWT Configuration (MUST match Auth Service's secret and expiration)
# These are used by the API Gateway's JwtAuthenticationFilter to validate tokens
jwt.secret=YVMzYyFxUjhsTWJ6WHk3MWVMKm9ARzUhaE5wMlVkWGU=
jwt.expiration=36000000 # 10 hours in milliseconds (10 * 60 * 60 * 1000)

# Logging Details
logging.level.com.netflix.discovery=DEBUG
logging.level.org.springframework.boot.autoconfigure=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.orm.jdbc.bind=TRACE
logging.level.io.github.resilience4j=DEBUG
logging.level.io.micrometer.tracing=DEBUG
logging.level.org.springframework.jdbc=DEBUG
logging.level.com.zaxxer.hikari=DEBUG
